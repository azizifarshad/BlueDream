@model BlueDream.Models.ViewModels.SubmitBookingViewModel
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Select Date & Time";
}

<div class="container my-5">
    <h2 class="mb-4">Select Date & Time for Your Booking</h2>

    <form asp-action="Submit" method="post" id="calendarForm">
        <input type="hidden" name="selectedTime" id="selectedTime" value="" />

        <div class="mb-4">
            <label for="datepicker" class="form-label fw-bold">Pick a Date:</label>
            <input type="text" id="datepicker" class="form-control" placeholder="Select a date" autocomplete="off" required />
        </div>

        <div class="mb-4">
            <label class="form-label fw-bold">Select a Time Slot:</label>
            <div id="timeSlots" class="d-flex flex-wrap gap-2">
                <!-- Time slots will be appended here by JS -->
            </div>
        </div>

        <div class="mb-4">
            <h4>Selected Items:</h4>
            <ul class="list-group">
                @foreach(var item in Model.SelectedItems)
                {
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>@item.Name (@item.TimeSpend min)</span>
                        <span>€@(item.Discount > 0 ? item.Price - (item.Price * item.Discount / 100) : item.Price)</span>
                    </li>
                }
            </ul>
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg px-5">Next →</button>
        </div>
    </form>
</div>

@section Scripts {
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
    // نمونه تاریخ های غیرفعال (می تونی از API بک اند بگیری)
    var disabledDates = []; // ['2025-11-25', '2025-11-26']

    // نمونه زمان های موجود در هر روز (می تونی از بک اند بگیری)
    var timeSlots = [
        '09:00', '10:00', '11:00', '12:00',
        '13:00', '14:00', '15:00', '16:00'
    ];

    flatpickr("#datepicker", {
        dateFormat: "Y-m-d",
        minDate: "today",
        disable: disabledDates,
        onChange: function(selectedDates, dateStr, instance) {
            renderTimeSlots(dateStr);
        }
    });

    function renderTimeSlots(dateStr) {
        var container = document.getElementById("timeSlots");
        container.innerHTML = "";

        timeSlots.forEach(function(time) {
            var btn = document.createElement("button");
            btn.type = "button";
            btn.className = "btn btn-outline-primary";
            btn.textContent = time;
            btn.onclick = function() {
                document.querySelectorAll("#timeSlots .btn").forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                document.getElementById("selectedTime").value = dateStr + " " + time;
            };
            container.appendChild(btn);
        });
    }
</script>

<style>
#timeSlots .btn {
    min-width: 80px;
    margin-bottom: 8px;
}
#timeSlots .btn.active {
    background-color: #1A2A6C;
    color: #fff;
}
</style>
}
